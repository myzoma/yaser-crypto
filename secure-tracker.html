<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØªØ¨Ø¹ Ø§Ù„ØªÙˆØµÙŠØ§Øª</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .controls { margin-bottom: 20px; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-info { background: #17a2b8; color: white; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: center; }
        th { background: #f8f9fa; }
        .profit-positive { color: #28a745; font-weight: bold; }
        .profit-negative { color: #dc3545; font-weight: bold; }
        .status-completed { background: #d4edda; }
        .status-pending { background: #fff3cd; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .stat-card { background: #f8f9fa; padding: 15px; border-radius: 8px; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š Ù…ØªØªØ¨Ø¹ Ø§Ù„ØªÙˆØµÙŠØ§Øª</h1>
        
        <div class="controls">
            <button class="btn-primary" onclick="captureRecommendations()">ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØªÙˆØµÙŠØ§Øª</button>
            <button class="btn-success" onclick="updatePrices()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</button>
            <button class="btn-info" onclick="generateReport()">ğŸ“ˆ ØªÙ‚Ø±ÙŠØ± Ù…ÙØµÙ„</button>
        </div>
        
        <div class="stats" id="stats"></div>
        <div id="recommendations"></div>
    </div>

    <script>
        let recommendations = JSON.parse(localStorage.getItem('recommendations') || '[]');

        function captureRecommendations() {
            try {
                // Ù…Ø­Ø§ÙˆÙ„Ø© Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©
                let coins = [];
                
                if (window.opener && window.opener.yaserCrypto && window.opener.yaserCrypto.coins) {
                    coins = window.opener.yaserCrypto.coins.slice(0, 15);
                    console.log('ØªÙ… Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰', coins.length, 'Ø¹Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©');
                } else {
                    alert('âš ï¸ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ø§ÙØªØ­ Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø© Ù…Ù† Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©');
                    return;
                }

                if (coins.length === 0) {
                    alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„Ø§Øª Ù„Ù„ØªÙ‚Ø§Ø·');
                    return;
                }

                // Ø­ÙØ¸ Ø§Ù„ØªÙˆØµÙŠØ§Øª
                coins.forEach(coin => {
                    const rec = {
                        id: Date.now() + Math.random(),
                        symbol: coin.symbol,
                        entryPrice: coin.price,
                        currentPrice: coin.price,
                        target1: coin.targets?.target1 || coin.price * 1.05,
                        target2: coin.targets?.target2 || coin.price * 1.10,
                        target3: coin.targets?.target3 || coin.price * 1.15,
                        stopLoss: coin.targets?.stopLoss || coin.price * 0.95,
                        timestamp: new Date().toISOString(),
                        status: 'pending',
                        profit: 0,
                        rank: coin.rank || 0,
                        score: coin.score || 0
                    };
                    recommendations.push(rec);
                });

                localStorage.setItem('recommendations', JSON.stringify(recommendations));
                renderRecommendations();
                updateStats();
                alert(`âœ… ØªÙ… Ø§Ù„ØªÙ‚Ø§Ø· ${coins.length} ØªÙˆØµÙŠØ©`);

            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØªÙˆØµÙŠØ§Øª:', error);
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØªÙˆØµÙŠØ§Øª');
            }
        }

        async function updatePrices() {
            if (recommendations.length === 0) {
                alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆØµÙŠØ§Øª Ù„Ù„ØªØ­Ø¯ÙŠØ«');
                return;
            }

            try {
                for (let rec of recommendations) {
                    if (rec.status === 'pending') {
                        // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¹Ø± (Ø§Ø³ØªØ¨Ø¯Ù„ Ø¨Ù€ API Ø­Ù‚ÙŠÙ‚ÙŠ)
                        const randomChange = (Math.random() - 0.5) * 0.1; // ØªØºÙŠÙŠØ± Ø¹Ø´ÙˆØ§Ø¦ÙŠ Â±5%
                        rec.currentPrice = rec.entryPrice * (1 + randomChange);
                        rec.profit = ((rec.currentPrice - rec.entryPrice) / rec.entryPrice) * 100;

                        // ÙØ­Øµ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù
                        if (rec.currentPrice >= rec.target1) {
                            rec.status = 'completed';
                        } else if (rec.currentPrice <= rec.stopLoss) {
                            rec.status = 'stopped';
                        }
                    }
                }

                localStorage.setItem('recommendations', JSON.stringify(recommendations));
                renderRecommendations();
                updateStats();
                alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø±');

            } catch (error) {
                console.error('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø±:', error);
                alert('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø³Ø¹Ø§Ø±');
            }
        }

        function renderRecommendations() {
            const container = document.getElementById('recommendations');
            
            if (recommendations.length === 0) {
                container.innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙˆØµÙŠØ§Øª. Ø§Ø¶ØºØ· "Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØªÙˆØµÙŠØ§Øª" Ù„Ù„Ø¨Ø¯Ø¡.</p>';
                return;
            }

            const html = `
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø¹Ù…Ù„Ø©</th>
                            <th>Ø³Ø¹Ø± Ø§Ù„Ø¯Ø®ÙˆÙ„</th>
                            <th>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ</th>
                            <th>Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø£ÙˆÙ„</th>
                            <th>Ø§Ù„Ø±Ø¨Ø­ %</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${recommendations.map(rec => `
                            <tr class="status-${rec.status}">
                                <td><strong>${rec.symbol}</strong></td>
                                <td>${rec.entryPrice.toFixed(6)}</td>
                                <td>${rec.currentPrice.toFixed(6)}</td>
                                <td>${rec.target1.toFixed(6)}</td>
                                <td class="${rec.profit >= 0 ? 'profit-positive' : 'profit-negative'}">
                                    ${rec.profit.toFixed(2)}%
                                </td>
                                <td>${getStatusText(rec.status)}</td>
                                <td>${new Date(rec.timestamp).toLocaleDateString('ar')}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            
            container.innerHTML = html;
        }

        function updateStats() {
            const total = recommendations.length;
            const completed = recommendations.filter(r => r.status === 'completed').length;
            const pending = recommendations.filter(r => r.status === 'pending').length;
            const stopped = recommendations.filter(r => r.status === 'stopped').length;
            const successRate = total > 0 ? ((completed / total) * 100).toFixed(1) : 0;
            const avgProfit = total > 0 ? (recommendations.reduce((sum, r) => sum + r.profit, 0) / total).toFixed(2) : 0;

            document.getElementById('stats').innerHTML = `
                <div class="stat-card">
                    <h3>ğŸ“Š Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙˆØµÙŠØ§Øª</h3>
                    <p style="font-size: 24px; font-weight: bold;">${total}</p>
                </div>
                <div class="stat-card">
                    <h3>âœ… Ù†Ø¬Ø­</h3>
                    <p style="font-size: 24px; font-weight: bold; color: #28a745;">${completed}</p>
                </div>
                <div class="stat-card">
                    <h3>â³ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h3>
                    <p style="font-size: 24px; font-weight: bold; color: #ffc107;">${pending}</p>
                </div>
                <div class="stat-card">
                    <h3>ğŸ“ˆ Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­</h3>
                    <p style="font-size: 24px; font-weight: bold; color: #17a2b8;">${successRate}%</p>
                </div>
                <div class="stat-card">
                    <h3>ğŸ’° Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø¨Ø­</h3>
                    <p style="font-size: 24px; font-weight: bold; color: ${avgProfit >= 0 ? '#28a745' : '#dc3545'};">${avgProfit}%</p>
                </div>
            `;
        }

        function getStatusText(status) {
            switch(status) {
                case 'pending': return 'â³ Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±';
                case 'completed': return 'âœ… ØªÙ… ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„Ù‡Ø¯Ù';
                case 'stopped': return 'âŒ ÙˆÙ‚Ù Ø®Ø³Ø§Ø±Ø©';
                default: return status;
            }
        }

        function generateReport() {
            if (recommendations.length === 0) {
                alert('âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªÙ‚Ø±ÙŠØ±');
                return;
            }

            const report = `
                ğŸ“Š ØªÙ‚Ø±ÙŠØ± Ø§Ù„ØªÙˆØµÙŠØ§Øª
                ==================
                Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙˆØµÙŠØ§Øª: ${recommendations.length}
                Ù†Ø¬Ø­: ${recommendations.filter(r => r.status === 'completed').length}
                Ù‚ÙŠØ¯ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±: ${recommendations.filter(r => r.status === 'pending').length}
                Ù…Ø¹Ø¯Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­: ${recommendations.length > 0 ? ((recommendations.filter(r => r.status === 'completed').length / recommendations.length) * 100).toFixed(1) : 0}%
                
                Ø£ÙØ¶Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Øª:
                ${recommendations
                    .filter(r => r.profit > 0)
                    .sort((a, b) => b.profit - a.profit)
                    .slice(0, 5)
                    .map(r => `${r.symbol}: +${r.profit.toFixed(2)}%`)
                    .join('\n')}
            `;
            
            alert(report);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', function() {
            renderRecommendations();
            updateStats();
        });
    </script>
</body>
</html>
